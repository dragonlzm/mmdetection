# this script is for analyze the prediction of the imagenet predition
import json
import os
import requests
import numpy as np
from PIL import Image
import matplotlib.pyplot as plt
import matplotlib.patches as patches


# load the gt result, confirm which gt categories exist
gt_annotations = json.load(open('/data/zhuoming/detection/coco/annotations/train_100imgs.json'))
from_img_id_to_gtbbox = {}

for ele in gt_annotations['annotations']:
    bbox = ele['bbox']
    category_id = ele['category_id']
    image_id = ele['image_id']
    bbox.append(category_id)
    if image_id not in from_img_id_to_gtbbox:
        from_img_id_to_gtbbox[image_id] = []
    from_img_id_to_gtbbox[image_id].append(bbox)

# create the mapping from the gt categories id to categories name
from_gt_cate_id_to_gt_cate_name = {}
for ele in gt_annotations['categories']:
    category_id = ele['id']
    category_name = ele['name']
    from_gt_cate_id_to_gt_cate_name[category_id] = category_name


all_img_info = {info['id']:info for info in gt_annotations['images']}

# create the mapping from the predicted categories id to categories name
# all_imagenet_cate = ['quilt', 'fastener', 'bakery', 'coyote', 'ballplayer', 'pedestal', 'pin', 'snow leopard', 'protective garment', 'Norfolk terrier', 'mechanical device', 'obstruction', 'baby bed', 'knot', 'toilet tissue', 'pool', 'durables', 'reflex camera', 'grille', 'Komodo dragon', 'warplane', 'bib', 'nutriment', 'Lakeland terrier', 'cobra', 'tray', 'plant organ', 'hamper', 'domestic cat', 'spiny-finned fish', 'saurian', 'amphibian', 'iron', 'tiger beetle', 'recreational vehicle', 'vest', 'Border terrier', 'sea duck', 'rock crab', 'cockroach', 'canoe', 'bloodhound', 'safety belt', 'ice cream', 'promontory', 'kite', 'squirrel', 'winter squash', 'standard schnauzer', 'indri', 'kimono', 'hammer', 'sea cow', 'crutch', 'breakwater', 'heater', 'cream', 'peacock', 'memory device', 'artifact', 'pepper', 'feed', 'horizontal surface', 'starches', 'racer', 'boathouse', 'Staffordshire bullterrier', 'sea boat', 'mixing bowl', 'gun', 'fungus', 'saltshaker', 'sailboat', 'dishrag', 'cradle', 'sax', 'croquet ball', 'white wolf', 'pole', 'beach wagon', 'sandglass', 'pipe', 'slide rule', 'cap', 'spatula', 'venomous lizard', 'cloak', 'foodstuff', 'Shetland sheepdog', 'weight', 'coffee', 'accessory', 'supporting structure', 'laptop', 'foxhound', 'lionfish', 'sea slug', 'flagpole', 'sea cucumber', 'water ouzel', 'mortarboard', 'crocodile', 'wallet', 'fire engine', 'wolf', 'water bottle', 'optical instrument', 'orange', 'police van', 'work', 'Leonberg', 'water jug', 'Australian terrier', 'toiletry', 'hammerhead', 'reef', 'tape player', 'bus', 'black-footed ferret', 'fountain', 'malinois', 'drumstick', 'agama', 'shower cap', 'German shepherd', 'bathtub', 'apiary', 'light microscope', 'football helmet', 'feline', 'house finch', 'establishment', 'setter', 'black-and-tan coonhound', 'disk brake', 'chambered nautilus', 'nematode', 'window blind', 'coot', 'sock', 'landing', 'spider monkey', 'sunglasses', 'chickadee', 'spoonbill', 'bicycle', 'lesser panda', 'miniature schnauzer', 'seat', 'pencil sharpener', 'sweet pepper', 'outbuilding', 'tent', 'snowmobile', 'bun', 'European fire salamander', 'gastropod', 'footwear', 'porcupine', 'llama', 'duck', 'accordion', 'custard apple', 'half track', 'pay-phone', 'protective covering', 'monitor', 'tub', 'garter snake', 'boa constrictor', 'dam', 'leafhopper', 'gazelle', 'salmon', 'shaker', 'boxer', 'mask', "carpenter's kit", 'Chesapeake Bay retriever', 'restaurant', 'crash helmet', 'eating apple', 'stony coral', 'dictyopterous insect', 'support', 'ceratopsian', 'spacecraft', 'brassiere', 'drygoods', 'Welsh terrier', 'fruit', 'sandwich', 'tower', 'medicine chest', 'titi', 'little blue heron', 'miniature poodle', 'timber wolf', 'New World monkey', 'train', 'catamaran', 'rack', 'tick', 'upright', 'centipede', 'cattle', 'mug', 'dingo', 'lamp', 'neckwear', 'church', 'combination lock', 'restraint', 'bassoon', 'vehicle', 'autoloader', 'hornbill', 'albatross', 'jeep', 'locomotive', 'butcher shop', 'cup', 'automatic firearm', 'loggerhead', 'coil', 'bicycle-built-for-two', 'pump', 'pot', 'marimba', 'cooker', 'American lobster', 'trench coat', 'crustacean', 'Yorkshire terrier', 'ringlet', 'course', 'griffon', 'Dandie Dinmont', 'bird', 'plate rack', 'plane', 'otter', 'fence', 'eagle', 'eared seal', 'great ape', 'banjo', 'ruffed grouse', 'soup bowl', 'marketplace', 'Arabian camel', 'dolphin', 'soup', 'bolo tie', 'Bernese mountain dog', 'seashore', 'astronomical telescope', 'ram', 'barn spider', 'instrument', 'tractor', 'kit fox', 'television', 'collie', 'rack', 'tabby', 'common iguana', 'cephalopod', 'balloon', 'automatic rifle', 'umbrella', 'confectionery', 'vase', 'winder', 'lynx', 'library', 'shark', 'Dutch oven', 'guenon', 'explorer', 'organism', 'Rhodesian ridgeback', 'grouse', 'pomegranate', 'sleeping bag', 'red wine', 'marsupial', 'rubber eraser', 'insect', 'obelisk', 'aquatic bird', 'wheeled vehicle', 'harmonica', 'Madagascar cat', 'sweatshirt', 'pierid', 'frog', 'running shoe', 'barrel', 'steel drum', 'puffer', 'personal computer', 'house', 'sea snake', 'safety pin', 'trailer truck', 'jay', 'pirate', 'Saint Bernard', 'sea lion', 'abacus', 'moving van', 'African hunting dog', 'upright', 'Sussex spaniel', 'weevil', 'oystercatcher', 'green snake', 'springer spaniel', 'orangutan', 'maypole', 'beagle', 'ringneck snake', 'bath linen', 'vault', 'institution', 'throne', 'goblet', 'microscope', 'machine gun', 'key', 'mailbox', 'tracked vehicle', 'buckeye', 'bridge', 'harvestman', 'electric ray', 'coraciiform bird', 'megalith', 'motorcycle', 'tailed frog', 'Tibetan mastiff', 'big cat', 'cruciferous vegetable', 'magnetic disk', 'anguid lizard', 'linen', 'kit', 'workwear', 'gown', 'Siamese cat', 'coffee mug', 'birdhouse', 'Newfoundland', 'seabird', 'Border collie', 'frilled lizard', 'West Highland white terrier', 'espresso', 'tree squirrel', 'dhole', 'washbasin', 'mountain', 'mosquito net', 'matchstick', 'odometer', 'box turtle', 'terrapin', 'anthropoid ape', 'shield', 'filter', 'ptarmigan', 'traffic light', 'shore', 'white goods', 'building complex', 'Maltese dog', 'sunscreen', 'Norwich terrier', 'schooner', 'cowboy boot', 'freight car', 'groenendael', 'safe', 'lab coat', 'elapid', 'pop bottle', 'Great Pyrenees', 'water tower', 'apodiform bird', 'electronic equipment', 'American coot', 'sloth bear', 'stole', 'outerwear', 'ping-pong ball', 'instrument of execution', 'conch', 'table lamp', 'neck brace', 'grocery store', 'food fish', 'scorpion', 'gymnastic apparatus', 'anemone fish', 'writing implement', 'miniskirt', 'giant schnauzer', 'Eskimo dog', 'small boat', 'bluetick', 'drilling platform', 'snake', 'hydraulic brake', 'beaver', 'padding', 'chain mail', 'door', 'great white shark', 'pheasant', 'Saluki', 'mongoose', 'black mamba', 'chiton', 'dalmatian', 'echinoderm', 'source of illumination', 'case', 'robin', 'gear', 'beaker', 'barrier', 'shoe', 'bony fish', 'poncho', 'sheep', 'oxcart', 'hymenopterous insect', 'purse', 'elephant', 'Siberian husky', 'colobus', 'Bouvier des Flandres', 'sea anemone', 'shoji', 'piggy bank', 'tricycle', 'siamang', 'anthozoan', 'gong', 'aircraft carrier', 'gondola', 'hair slide', 'cassette player', 'sidewinder', 'spermatophyte', 'sulphur butterfly', 'gorilla', 'wing', 'seal', 'slug', 'single-reed instrument', 'macaw', 'handwear', 'compass', 'antelope', 'gyromitra', 'measuring cup', 'bookcase', 'horse', 'egret', 'dishwasher', 'Band Aid', 'mitten', 'sandbar', 'French horn', 'rodent', 'airliner', 'oven', 'mobile home', 'hunting dog', 'aquatic mammal', 'measuring stick', 'pointer', 'pinniped mammal', 'scuba diver', 'skunk', 'publication', 'mamba', 'chest of drawers', 'apparel', 'Shih-Tzu', 'badger', 'dome', "potter's wheel", 'microphone', 'whiptail', 'flamingo', 'horizontal bar', 'file', 'wind instrument', 'water buffalo', 'ball', 'cat', 'musical instrument', 'space shuttle', 'wreck', 'spider', 'Pomeranian', 'Gordon setter', 'black widow', 'ski mask', 'hook', 'thatch', 'Brabancon griffon', 'Irish water spaniel', 'decoration', 'basidiomycete', 'fireboat', 'mercantile establishment', 'disguise', 'park bench', 'requiem shark', 'English setter', 'telephone', 'jewelry', 'machine', 'acoustic guitar', 'doormat', 'carbonara', 'wombat', 'tool', 'pan', 'convertible', 'eft', 'wild dog', 'capuchin', 'chair of state', 'gallinule', 'watchdog', 'brake', 'self-propelled vehicle', 'hay', 'apple', 'beacon', 'bulbul', 'spiny lobster', 'gas pump', 'coelenterate', 'grain', 'ski', 'white goods', 'ballpoint', 'corkscrew', 'toothed whale', 'person', 'pit viper', 'camel', 'book jacket', 'redshank', 'mammal', 'radiator', 'warship', 'garbage truck', 'electric guitar', 'cello', 'fan', 'wire-haired fox terrier', 'golfcart', 'plunger', 'bulldog', 'ship', 'clog', 'Afghan hound', 'panpipe', 'cutlery', 'valley', 'limpkin', 'fire screen', 'beer glass', 'can', 'china cabinet', 'column', 'stopwatch', 'spotted salamander', 'American alligator', 'place of business', 'teapot', 'mud turtle', 'glove', 'game', 'percoid fish', 'perfume', 'Scotch terrier', 'dress', 'mechanism', 'hip', 'sled dog', 'sheath', 'ratite', 'ocarina', 'shield', 'danaid', 'tableware', 'caldron', 'radiotelephone', 'archosaur', 'screw', 'bikini', 'percussion instrument', 'dumbbell', 'post', 'scarf', 'oilseed', 'Granny Smith', 'military uniform', 'red wolf', 'stew', 'utensil', 'clip', 'toy terrier', 'shepherd dog', 'baboon', 'whale', 'airplane', 'toaster', 'whistle', 'knee pad', 'binder', "jack-o'-lantern", 'night snake', 'ape', 'French bulldog', 'area', 'printer', 'clock', 'coat', 'cabbage butterfly', 'plaything', 'snail', 'eel', 'retriever', 'power drill', 'wallaby', 'meter', 'robe', 'shopping basket', 'hair spray', 'gar', 'hot pot', 'lumbermill', 'pudding', 'correctional institution', 'blind', 'brain coral', 'invertebrate', 'runner', 'handkerchief', 'glass', 'bovine', 'menu', 'rain barrel', 'owl', 'article', 'cairn', 'spindle', 'skirt', 'lakeside', 'ray', 'cocker spaniel', 'maraca', 'damselfish', 'Tibetan terrier', 'monastery', 'leatherback turtle', 'trilobite', 'screen', 'sofa', 'covering', 'lifeboat', 'breathing device', 'motor scooter', 'mailbag', 'elasmobranch', 'screen', 'holster', 'whiskey jug', 'photographic equipment', 'Sealyham terrier', 'computer', 'wolf spider', 'American Staffordshire terrier', 'reflector', 'hamburger', 'cinema', 'snipe', 'reel', 'optical device', 'toy spaniel', 'wood rabbit', 'top', 'scientific instrument', 'nipple', 'limousine', 'coffeepot', 'makeup', 'EntleBucher', 'punching bag', 'barbershop', 'velvet', 'cellular telephone', 'bonnet', 'palace', 'spotlight', 'geological formation', 'space bar', 'worm fence', 'Greater Swiss Mountain dog', 'cocktail shaker', 'bottle opener', 'pullover', 'parachute', 'oscilloscope', 'telecommunication system', 'stupa', 'housing', 'submarine', 'meat loaf', 'adhesive bandage', 'keyboard', 'eraser', 'lock', 'fox squirrel', 'lycaenid', 'transducer', 'bull mastiff', 'viaduct', 'broccoli', 'rapeseed', 'schipperke', 'lion', 'waffle iron', 'tusker', 'bullet train', 'barber chair', 'artichoke', 
#                     'American egret', 'fountain pen', 'diamondback', 'table', 'container', 'alligator lizard', 'maze', 'nymphalid', 'cliff dwelling', 'duplicator', 'sauce', 'lepidopterous insect', 'burrito', 'dispenser', 'web', 'lighter-than-air craft', 'entree', 'fox', 'hen-of-the-woods', 'home theater', 'piciform bird', 'European gallinule', 'fish', 'movable barrier', 'vine snake', 'edible fruit', 'minibus', 'handcart', 'tennis ball', 'warthog', 'refrigerator', 'spaniel', 'snowplow', 'bed', 'odonate', 'Persian cat', 'tank', 'pot', 'plate', 'thresher', 'typewriter keyboard', 'free-reed instrument', 'trombone', 'starfish', 'bell pepper', 'beverage', 'vestment', 'pelecaniform seabird', 'stereo', 'communication system', 'komondor', 'sea turtle', 'crockery', 'bannister', 'prison', 'garment', 'mountain bike', 'overgarment', 'English springer', 'bearskin', 'ungulate', 'guinea pig', 'chain saw', 'barbell', 'wolfhound', 'whippet', 'hamster', 'Brittany spaniel', 'knife', 'loudspeaker', 'bell cote', 'shade', 'bar', 'peer', 'electronic device', 'airfoil', 'ant', 'chest', 'framework', 'worm', 'converging lens', 'pickup', 'hoopskirt', 'ox', 'four-poster', 'platform', 'salamander', 'lagomorph', 'diver', 'hartebeest', 'racket', 'rhinoceros beetle', 'red-breasted merganser', 'fodder', 'pelican', 'comic book', 'earthstar', 'bowed stringed instrument', 'plow', 'stage', 'hog', 'paper towel', 'goldfish', 'Appenzeller', 'lampshade', 'dragonfly', 'ware', 'wirehair', 'raincoat', 'hand blower', 'hare', 'king penguin', 'medical instrument', 'apparatus', 'cargo ship', 'Labrador retriever', 'letter opener', 'cucumber', 'joystick', 'cleaning implement', 'Scottish deerhound', 'volleyball', 'bunting', 'chelonian', 'spaghetti squash', 'bowl', 'wild sheep', 'bow', 'king snake', 'nightingale', 'projector', 'disk', 'shirt', 'telescope', 'cash machine', 'cooking utensil', 'cowboy hat', 'goldfinch', 'ligament', 'daisy', 'frying pan', 'red-backed sandpiper', 'fortification', 'bag', 'moped', 'buckle', 'screwdriver', 'pachyderm', 'placental', 'flatworm', 'teddy', 'pencil box', 'manhole cover', 'electric locomotive', 'curtain', 'Ibizan hound', 'racer', 'odd-toed ungulate', 'canine', 'affenpinscher', 'prairie chicken', 'measure', 'dinosaur', 'footwear', 'modem', 'motor vehicle', 'decapod crustacean', 'excavation', 'viverrine', 'crocodilian reptile', 'brake system', 'carnivore', 'standard poodle', 'rock beauty', 'teiid lizard', 'toyshop', 'quill', 'flat-coated retriever', 'double-reed instrument', 'face powder', 'cloth covering', 'Chihuahua', 'cypriniform fish', 'hand glass', 'otterhound', 'sliding door', 'tiger cat', 'electro-acoustic transducer', 'lemon', 'litter', 'strawberry', 'studio couch', 'brown bear', 'snorkel', 'African chameleon', 'photocopier', 'English foxhound', 'liner', 'car', 'hotdog', 'butternut squash', 'turnstile', 'clothing', 'Kerry blue terrier', 'phasianid', 'swimsuit', 'phalanger', 'Doberman', 'axolotl', 'necktie', 'pome', 'pizza', 'electrical device', 'cannon', 'dip', 'water snake', 'plate', 'dugong', 'pickelhaube', 'shower curtain', 'minibike', 'shopping cart', 'car wheel', 'space heater', 'jaguar', 'contestant', 'steel arch bridge', 'German short-haired pointer', 'weapon', 'car', 'woodwind', 'ear', 'green lizard', 'damselfly', 'furnishing', 'berry', 'unicycle', 'zebra', 'dryer', 'rod', 'shelter', 'groom', 'coral fungus', 'coucal', 'squirrel monkey', 'sewing machine', 'oboe', 'Japanese spaniel', 'red fox', 'consumer goods', 'home appliance', 'forklift', 'hognose snake', 'barrow', 'military vehicle', 'planetarium', 'bison', 'finch', 'prototherian', 'lens', 'quail', 'aircraft', 'butterfly fish', 'magpie', 'yawl', 'cliff', 'cutting implement', 'sombrero', 'radio', 'go-kart', 'lifting device', 'digital computer', 'grey whale', 'homopterous insect', 'procyonid', 'dial telephone', 'sports implement', 'dogsled', 'design', 'partridge', 'keeshond', 'pen', 'monkey', 'structure', 'grasshopper', 'broom', "lady's slipper", 'chimpanzee', 'Old English sheepdog', 'convertible', 'oscine', 'armor plate', 'amphibian', 'indigo bunting', 'lacertid lizard', 'window screen', 'sloth', 'three-toed sloth', 'ax', 'angiosperm', 'sea urchin', 'basset', 'drill rig', 'maillot', 'stick', 'horse cart', 'coral reef', 'sturgeon', 'black swan', 'bee', 'pinscher', 'pistol', 'beer bottle', 'muzzle', 'projectile', 'lesser ape', 'savings bank', 'shed', 'control', 'mousetrap', 'sphenisciform seabird', 'bubble', 'hairpiece', 'rocket', 'platypus', 'hat', 'bathing cap', 'wildcat', 'body armor', 'roof', 'magazine', 'peafowl', 'wine', 'Gila monster', 'true lobster', 'navigational instrument', 'scabbard', 'hippopotamus', 'hatchet', 'floor cover', 'meerkat', 'residence', 'sled', 'cicada', 'Boston bull', 'Italian greyhound', 'passenger ship', 'commodity', 'receptacle', 'wrapping', 'firearm', 'hound', 'Pembroke', 'orchid', 'swine', 'toy dog', 'junco', 'reproducer', 'golden retriever', 'cuckoo', 'ostrich', 'headdress', 'Great Dane', 'crane', 'stone wall', 'koala', 'oxygen mask', 'overskirt', 'frozen dessert', 'dwelling', 'sports equipment', "woman's clothing", 'Irish setter', 'vizsla', 'chordate', 'strongbox', 'yurt', 'dining table', 'building', 'analog computer', 'even-toed ungulate', 'constrictor', 'rail fence', 'bench', 'scorpaenid', 'cistern', 'organ', 'wine bottle', 'altar', 'bedclothes', 'toucan', 'curly-coated retriever', 'wok', 'carton', 'piece of cloth', 'proboscis monkey', 'Old World monkey', 'bedroom furniture', 'summer squash', 'boot', 'Mexican hairless', 'patas', 'dough', 'parking meter', 'mat', 'scorpaenoid', 'great grey owl', 'Weimaraner', 'magnifier', 'long-horned beetle', 'goose', 'bald eagle', 'mountain tent', 'brambling', 'grey fox', 'tarantula', 'parallel bars', 'malamute', 'jellyfish', 'syringe', 'spider web', 'kelpie', 'potato', 'American black bear', 'chocolate sauce', 'box', 'equipment', 'feather boa', 'tow truck', 'python', 'assault rifle', 'trolleybus', 'bassinet', 'lens cap', 'paddle', 'Angora', 'bullterrier', 'barn', 'cavy', 'arachnid', 'basketball', 'helmet', 'revolver', 'hourglass', 'nail', 'paintbrush', 'ruminant', 'maillot', 'sandpiper', 'ashcan', 'plant part', 'rig', 'African crocodile', 'lighter', 'game equipment', 'balance beam', 'mosque', 'tiger', 'natural object', 'Rottweiler', 'impala', 'cuculiform bird', 'wheel', 'washer', 'cricket', 'miniature pinscher', 'school bus', 'theater', 'cardigan', 'Norwegian elkhound', 'chiffonier', 'sports car', 'drum', 'rugby ball', 'isopod', 'entertainment center', 'candle', 'wild goat', 'rifle', 'armor', 'iPod', 'French loaf', 'necklace', 'craft', 'mouse', 'hummingbird', 'academic gown', 'trimaran', 'cosmetic', 'pretzel', 'thrush', 'power saw', 'sulphur-crested cockatoo', 'shorebird', 'office furniture', 'barracouta', 'puzzle', 'marmot', 'adornment', 'plant', 'furniture', 'van', 'admiral', 'Bedlington terrier', 'Petri dish', 'jacket', 'Polaroid camera', 'tree frog', 'diaper', 'timer', 'dish', 'acorn', 'equine', 'viper', 'schnauzer', 'plant', 'wagon', 'greyhound', 'structural member', 'lorikeet', 'Walker hound', 'soft-finned fish', 'Airedale', 'neuropteron', 'thimble', 'device', 'participant', 'package', 'bovid', 'factory', 'strainer', 'jackfruit', 'fabric', 'jar', 'lamellicorn beetle', 'patio', 'trifle', 'ladybug', 'spitz', 'alp', 'lemur', 'web site', 'sporting dog', 'tile roof', 'American chameleon', 'working dog', 'titmouse', 'Irish terrier', 'loupe', 'bagel', 'monotreme', 'purple gallinule', 'chameleon', 'bear', 'kernel', 'turtle', 'stringed instrument', 'nightwear', 'bird of prey', 'tripod', 'mashed potato', 'domestic animal', 'jug', 'harp', 'bobsled', 'head cabbage', 'shop', 'totem pole', 'rocking chair', 'passenger train', 'drake', 'beetle', 'binoculars', 'Lhasa', 'turnstone', 'black stork', 'penal institution', 'basin', 'thunder snake', 'mountain sheep', 'dock', 'briard', 'scale', 'ice lolly', 'mirror', 'kuvasz', 'honeycomb', 'espresso maker', 'bin', 'dog', 'crossword puzzle', 'slot machine', 'audio system', 'cuirass', 'portable computer', 'crab', 'wading bird', 'grand piano', 'rescue equipment', 'cheetah', 'golf ball', 'notebook', 'instrumentality', 'sundial', 'ambystomid', 'digital watch', 'wooden spoon', 'Belgian sheepdog', 'bee eater', 'edge tool', 'African elephant', 'bulletproof vest', 'rock python', 'brass', 'natural depression', 'data input device', 'fur coat', 'Pekinese', 'towel', 'jigsaw puzzle', 'penguin', 'magnetic compass', 'electric fan', 'seat belt', 'leporid', 'seed', 'hermit crab', 'poodle', 'Windsor tie', 'chow', 'apron', 'eggnog', 'orthopterous insect', 'solar dish', 'pinwheel', 'metatherian', 'mortar', 'pillow', 'microwave', 'swan', 'wardrobe', 'spring', 'chainlink fence', 'folding chair', 'wall unit', 'cyprinid', 'heron', 'teleost fish', 'marmoset', 'macaque', 'pajama', 'lawn mower', 'Old World buffalo', 'volcano', 'bittern', 'Samoyed', 'vessel', 'pineapple', 'CD player', 'newt', 'iguanid', 'garden tool', 'common newt', 'window shade', 'ground beetle', 'camera', 'can opener', 'wall clock', 'echidna', 'bottlecap', 'radio telescope', 'lory', 'bucket', 'rail', 'connection', 'car mirror', 'appliance', 'clumber', 'vacuum', 'padlock', 'display', 'langur', 'silky terrier', 'plectognath', 'corgi', 'flower', 'emblem', 'animal', 'Egyptian cat', 'fox terrier', 'black and gold garden spider', 'timepiece', 'leopard', 'prayer rug', 'cockatoo', 'attire', 'white stork', 'dessert', 'guillotine', 'tank', 'vertebrate', 'farm machine', 'dowitcher', 'sunglass', 'malacostracan crustacean', 'mackerel shark', 'greenhouse', 'vending machine', 'Loafer', 'stingray', 'scarabaeid beetle', 'defensive structure', 'speedboat', 'conveyance', 'rotisserie', 'tench', 'lizard', 'ruddy turnstone', 'memorial', 'pill bottle', 'redbone', 'coral', 'violin', 'toilet seat', 'picket fence', 'cauliflower', 'system', 'chain', 'bustard', 'crayfish', 'triceratops', 'bow tie', 'chair', 'corvine bird', 'passenger van', 'black grouse', 'cabbage', 'monarch', 'athlete', 'cutter', 'Indian elephant', 'castle', 'mastiff', 'gibbon', 
#                     'toy poodle', 'heavier-than-air craft', 'hawk', 'Crock Pot', 'soft-coated wheaten terrier', 'suit', 'digital clock', 'turner', 'banded gecko', 'beating-reed instrument', 'hand tool', 'parrot', 'minivan', 'vessel', 'rabbit', 'puck', 'canopy', 'peripheral', 'anseriform bird', 'cleaver', 'cetacean', 'mollusk', 'theater curtain', 'sailing vessel', 'polecat', 'Dungeness crab', 'lantern', 'banana', 'slot', 'Welsh springer spaniel', 'Cardigan', 'leaf beetle', 'gallinaceous bird', 'stretcher', 'pitcher', 'shovel', 'place of worship', 'oil filter', 'associate', 'coho', 'English toy spaniel', 'bighorn', 'colubrid snake', 'goat', 'lever', 'monitor', 'fig', 'ibex', 'basket', 'brass', 'motorboat', 'natural elevation', 'sorrel', 'triumphal arch', 'geyser', 'consomme', 'torch', 'mushroom', 'sheet', 'bath towel', 'waterfowl', 'kitchen appliance', 'missile', 'tiger shark', 'coffee maker', 'steam locomotive', 'light', 'shrine', 'punch', 'king crab', 'reproductive structure', 'cougar', "yellow lady's slipper", 'hard disc', 'pool table', 'gasmask', 'lacewing', 'crib', 'sarong', 'bottle', 'jean', 'acorn squash', 'sharpener', 'staff', 'sweater', 'alligator', 'watch', 'stocking', 'game bird', 'stove', 'basenji', 'abaya', 'pick', 'gate', 'grate', 'power tool', 'guacamole', 'stinkhorn', 'reservoir', 'dung beetle', 'ornithischian', 'envelope', 'butterfly', 'board', 'jersey', 'pug', 'armadillo', 'agamid', 'airship', 'bandage', 'citrus', 'ganoid', 'stethoscope', 'ridge', 'Christmas stocking', 'baseball', 'Blenheim spaniel', 'desktop computer', 'water spaniel', 'chime', 'borzoi', 'kangaroo', 'mantis', 'jacamar', 'potpie', 'oar', 'packet', 'mixed drink', 'spoon', 'vulture', 'religious residence', 'ride', 'backpack', 'fly', 'rule', 'rattlesnake', 'walking stick', 'surface', 'reptile', 'suspension bridge', 'breastplate', 'plover', 'streetcar', 'merganser', 'spectacles', 'dipterous insect', 'cabinet', 'dressing', 'cheeseburger', 'giant panda', 'African grey', 'anapsid', 'true frog', 'baleen whale', 'wig', 'piano', 'cornet', 'Model T', 'cassette', 'guitar', 'hyena', 'alcohol', 'hand-held computer', 'cab', 'computer keyboard', 'belt', 'screen', 'vegetable', 'green mamba', 'fiddler crab', 'scoreboard', 'creation', 'shoe shop', 'carousel', 'street sign', 'rug', 'crate', 'measuring instrument', 'desk', 'agaric', 'switch', 'product', 'corn', 'soccer ball', 'tobacco shop', 'gecko', 'public transport', 'milk can', 'Sennenhunde', 'weasel', 'phasmid', 'flute', 'barometer', 'ambulance', 'harvester', 'opener', 'bookshop', 'soap dispenser', 'aquatic vertebrate', 'tights', 'submersible', 'garden spider', 'calculator', 'cock', 'arthropod', 'passerine', 'farm building', 'pier', 'bullfrog', 'acarine', 'Arctic fox', 'analog clock', 'trap', 'killer whale', 'Indian cobra', 'cart', 'concoction', 'machine', 'wild boar', 'passenger car', 'primate', 'ladle', 'jinrikisha', 'container ship', 'truck', 'uniform', 'howler monkey', 'paddlewheel', 'swing', 'sandal', 'musteline mammal', 'mink', 'lipstick', 'brush', 'lobster', 'terrier', 'diapsid', 'lotion', 'vascular plant', 'implement', 'signaling device', 'brace', 'hosiery', 'coonhound', 'Irish wolfhound', 'cushion', 'zucchini', 'remote control', 'hen', 'papillon', 'solanaceous vegetable', 'ice bear', 'chordophone', 'boa', 'drinking vessel', 'horned viper', 'plastic bag', 'stork', 'pelagic bird', 'cardoon', 'wool', 'attachment', 'swab', 'cartilaginous fish', 'squash', 'swimming trunks', 'face mask', 'bolete', 'edentate', 'kitchen utensil', 'gown', 'boat']

#all_imagenet_cate = ['self-propelled vehicle', 'lantern', 'turner', 'bed', 'overgarment', 'lighter-than-air craft', 'drill rig', 'pointer', 'decapod crustacean', 'shore', 'tent', 'light', 'cat', 'finch', 'New World monkey', 'hunting dog', 'table', 'rocket', 'wind instrument', 'coffee', 'supporting structure', 'post', 'feed', 'penguin', 'fruit', 'brush', 'scorpaenid', 'goat', 'photographic equipment', 'squirrel', 'headdress', 'key', 'woodwind', 'piano', 'writing implement', 'anapsid', 'bottle', 'apparatus', 'Belgian sheepdog', 'worm', 'opener', 'instrument', 'train', 'piece of cloth', 'musteline mammal', 'dolphin', 'hand tool', 'malacostracan crustacean', 'consumer goods', 'design', 'equipment', 'toothed whale', 'turnstone', 'cream', 'wolf', 'place of business', 'game', 'measure', 'fastener', 'pin', 'camera', 'double-reed instrument', 'automatic firearm', 'spider', 'anseriform bird', 'signaling device', 'disk', 'car', 'motorboat', 'sandwich', 'cetacean', 'tableware', 'dryer', 'starches', 'salamander', 'cruciferous vegetable', 'orthopterous insect', 'brake', 'fox terrier', 'working dog', 'monotreme', 'merganser', 'basket', 'oscine', 'contestant', 'pudding', 'light microscope', 'shaker', 'gallinaceous bird', 'ambystomid', 'watchdog', 'barrier', 'requiem shark', 'pistol', 'public transport', 'wading bird', 'raincoat', 'excavation', 'bandage', 'conveyance', 'spacecraft', 'shark', 'grate', 'pan', 'container', 'gymnastic apparatus', 'truck', 'disguise', 'stereo', 'keyboard', 'homopterous insect', "woman's clothing", 'agamid', 'ceratopsian', 'danaid', 'makeup', 'furniture', 'ride', 'hydraulic brake', 'hamburger', 'weapon', 'durables', 'carnivore', 'case', 'elapid', 'procyonid', 'fan', 'memorial', 'craft', 'natural elevation', 'establishment', 'framework', 'astronomical telescope', 'sharpener', 'cabinet', 'rug', 'viper', 'sports implement', 'cutting implement', 'odd-toed ungulate', 'purple gallinule', 'schnauzer', 'tree squirrel', 'sweater', 'telescope', 'orchid', 'wild goat', 'echinoderm', 'neuropteron', 'wirehair', 'covering', 'cattle', 'ray', 'decoration', 'pump', 'thrush', 'power tool', 'percoid fish', 'ball', 'home appliance', 'natural depression', 'institution', 'anthozoan', 'wheeled vehicle', 'sailboat', 'dress', 'helmet', 'floor cover', 'alligator', 'calculator', 'reservoir', 'cyprinid', 'diver', 'rescue equipment', 'magazine', 'basin', 'bus', 'electro-acoustic transducer', 'phasmid', 'plant part', 'data input device', 'article', 'true frog', 'scarf', 'black mamba', 'savings bank', 'vehicle', 'pelecaniform seabird', 'grain', 'robe', 'fish', 'seabird', 'flower', 'shelter', 'elephant', 'constrictor', 'brace', 'arthropod', 'sauce', 'electronic device', 'utensil', 'protective covering', 'canine', 'eagle', 'colubrid snake', 'military vehicle', 'mollusk', 'gear', 'odonate', 'foxhound', 'dressing', 'soup', 'cuckoo', 'stocking', 'bedroom furniture', 'great ape', 'vessel', 'crockery', 'nymphalid', 'snake', 'electrical device', 'saurian', 'brake system', 'cart', 'power saw', 'chair of state', 'ratite', 'anguid lizard', 'cockatoo', 'boot', 'peafowl', 'sled', 'device', 'cistern', 'punch', 'plant', 'cephalopod', 'heavier-than-air craft', 'vascular plant', 'oilseed', 'wild dog', 'digital computer', 'gallinule', 'mechanism', 'cartilaginous fish', 'cavy', 'lory', 'religious residence', 'bag', 'bunting', 'roof', 'protective garment', 'optical instrument', 'chameleon', 'gastropod', 'passenger van', 'handwear', 'telecommunication system', 'chair', 'sheep', 'face mask', 'cloth covering', 'aquatic mammal', 'swan', 'domestic animal', 'equine', 'wagon', 'bench', 'restraint', 'rattlesnake', 'airfoil', 'cobra', 'marketplace', 'optical device', 'fortification', 'chordophone', 'eared seal', 'piciform bird', 'submersible', 'mastiff', 'duplicator', 'fodder', 'wildcat', 'nightwear', 'crocodile', 'Old World monkey', 'kitchen appliance', 'whale', 'ruminant', 'rack', 'mammal', 'setter', 'gecko', 'measuring stick', 'phalanger', 'top', 'house', 'crocodilian reptile', 'sheet', 'airplane', 'coral', 'game equipment', 'mug', 'sailing vessel', 'staff', 'radiotelephone', 'camel', 'pullover', 'Sennenhunde', 'clothing', 'autoloader', 'appliance', 'vegetable', 'cushion', 'coraciiform bird', 'cuculiform bird', 'invertebrate', 'foodstuff', 'product', 'frozen dessert', 'ridge', 'single-reed instrument', 'column', 'defensive structure', 'edentate', 'ship', 'reef', 'source of illumination', 'mirror', 'butterfly fish', 'sea turtle', 'control', 'wild sheep', 'magnifier', 'seed', 'correctional institution', 'cutter', 'winter squash', 'navigational instrument', 'neckwear', 'natural object', 'peripheral', 'window blind', 'dispenser', 'scorpaenoid', 'scarabaeid beetle', 'titmouse', 'bun', 'coffee maker', 'eraser', 'food fish', 'connection', 'housing', 'squash', 'timepiece', 'berry', 'body armor', 'magnetic disk', 'hat', 'instrument of execution', 'Welsh terrier', 'free-reed instrument', 'pen', 'reflector', 'bovine', 'chest of drawers', 'mackerel shark', 'cabbage', 'reptile', 'computer', 'skirt', 'entree', 'even-toed ungulate', 'associate', 'pheasant', 'guitar', 'lesser ape', 'accessory', 'rail', 'firearm', 'farm building', 'parrot', 'jacket', 'drinking vessel', 'shepherd dog', 'sports equipment', 'toy spaniel', 'canopy', 'coot', 'musical instrument', 'bear', 'jug', 'angiosperm', 'wolfhound', 'phasianid', 'apodiform bird', 'aquatic bird', 'timer', 'waterfowl', 'venomous lizard', 'automatic rifle', 'alcohol', 'footwear', 'sandpiper', 'wall unit', 'bottle opener', 'pit viper', 'tower', 'lepidopterous insect', 'white goods', 'cutlery', 'clock', 'machine gun', 'big cat', 'lizard', 'package', 'drygoods', 'workwear', 'chordate', 'passerine', 'shirt', 'leporid', 'sled dog', 'sea duck', 'plaything', 'fox', 'stony coral', 'coonhound', 'prototherian', 'hand glass', 'spitz', 'coat', 'beetle', 'python', 'plant organ', 'receptacle', 'farm machine', 'hosiery', 'strongbox', 'analog computer', 'snipe', 'bath linen', 'surface', 'mountain sheep', 'attire', 'mercantile establishment', 'converging lens', 'swimsuit', 'dip', 'uniform', 'swine', 'acarine', 'basidiomycete', "lady's slipper", 'dictyopterous insect', 'apparel', 'crab', 'fungus', 'kitchen utensil', 'place of worship', 'edible fruit', 'telephone', 'communication system', 'sandglass', 'vest', 'placental', 'citrus', 'watch', 'explorer', 'rabbit', 'ware', 'aquatic vertebrate', 'metatherian', 'theater', 'elasmobranch', 'gun', 'shoe', 'passenger train', 'safety belt', 'adornment', 'warship', 'ax', 'motor vehicle', 'lock', 'turtle', 'toy dog', 'bar', 'antelope', 'salmon', 'area', 'teiid lizard', 'dog', 'attachment', 'spiny-finned fish', 'publication', 'furnishing', 'lens', 'wrapping', 'cypriniform fish', 'breathing device', 'sofa', 'meter', 'soft-finned fish', 'geological formation', 'ligament', 'linen', 'box', 'primate', 'handcart', 'padding', 'ungulate', 'dish', 'corvine bird', 'portable computer', 'dessert', 'stork', 'pepper', 'sporting dog', 'tool', 'toiletry', 'pachyderm', 'mat', 'residence', 'aircraft', 'bowed stringed instrument', 'nightingale', 'rig', 'duck', 'clip', 'bedclothes', 'archosaur', 'spermatophyte', 'baby bed', 'tracked vehicle', 'display', 'athlete', 'horizontal surface', 'greyhound', 'fence', 'door', 'Old World buffalo', 'domestic cat', 'reproductive structure', 'bridge', 'viverrine', 'emblem', 'corgi', 'small boat', 'mountain', 'plover', 'grouse', 'shrine', 'apple', 'outbuilding', 'water spaniel', 'beverage', 'locomotive', 'vertebrate', 'sweet pepper', 'support', 'slot machine', 'cargo ship', 'ape', 'machine', 'tights', 'sloth', 'runner', 'rail fence', 'terrier', 'passenger ship', 'pome', 'potato', 'lagomorph', 'structure', 'anthropoid ape', 'kit', 'griffon', 'memory device', 'lever', 'horse', 'participant', 'true lobster', 'towel', 'percussion instrument', 'insect', 'game bird', 'boat', 'shop', 'work', 'mixed drink', 'bin', 'compass', 'chelonian', 'sea boat', 'cooking utensil', 'building', 'rod', 'microscope', 'seat', 'pierid', 'shade', 'cleaning implement', 'boa', 'poodle', 'stringed instrument', 'oven', 'spoon', 'pelagic bird', 'electronic equipment', 'garment', 'board', 'lifting device', 'bird', 'rodent', 'spectacles', 'bullterrier', 'dwelling', 'glass', 'arachnid', 'jewelry', 'web', 'eating apple', 'puzzle', 'cap', 'van', 'bird of prey', 'oar', 'heater', 'curtain', 'stew', 'knife', 'platform', 'summer squash', 'penal institution', 'stick', 'organism', 'movable barrier', 'hawk', 'pool', 'dinosaur', 'marsupial', 'litter', 'audio system', 'monkey', 'course', 'building complex', 'personal computer', 'creation', 'heron', 'factory', 'commodity', 'shed', 'lobster', 'necktie', 'ornithischian', 'sphenisciform seabird', 'person', 'minibike', 'office furniture', 'fabric', 'scientific instrument', 'system', 'butterfly', 'glove', 'lamellicorn beetle', 'structural member', 'iguanid', 'owl', 'seal', 'lacertid lizard', 'frog', 'transducer', 'crustacean', 'pinniped mammal', 'concoction', 'wheel', 'cosmetic', 'beating-reed instrument', 'can', 'bowl', 'peer', 'garden tool', 'bicycle', 'pinscher', 'sea cow', 'belt', 'teleost fish', 'solanaceous vegetable', 'ganoid', 'artifact', 'baleen whale', 'dipterous insect', 'lemur', 'cooker', 'armor plate', 'outerwear', 'kernel', 'medical instrument', 'nutriment', 'instrumentality', 'adhesive bandage', 'reproducer', 'lamp', 'spaniel', 'shorebird', 'landing', 'sheath', 'spring', 'gate', 'kangaroo', 'measuring instrument', 'trap', 'pipe', 'English toy spaniel', 'blind', 'egret', 'hairpiece', 'bovid', 'plectognath', 'coelenterate', 'feline', 'hound', 'mechanical device', 'springer spaniel', 'hymenopterous insect', 'wine', 'bulldog', 'armor', 'animal', 'winder', 'mamba', 'weight', 'obstruction', 'retriever', 'motorcycle', 'filter', 'bony fish', 'edge tool', 'jar', 'damselfish', 'diapsid', 'implement', 'newt']

all_imagenet_cate = ['animal', 'plant', 'person', 'fungus', 'artifact', 'natural object', 'beverage', 'geological formation', 'nutriment', 'vegetable']

from_pred_cate_id_to_pred_name = {i:ele for i, ele in enumerate(all_imagenet_cate)}
from_pred_name_to_pred_cate_id = {ele:i for i, ele in enumerate(all_imagenet_cate)}

#target_res_file_root = '/data/zhuoming/detection/coco/clip_proposal/train100_imagenet1762_confidence_score'
#target_res_file_root = '/data/zhuoming/detection/coco/clip_proposal/train100_imagenet743_confidence_score'

target_res_file_root = '/data/zhuoming/detection/coco/clip_proposal/train100_imagenet10_confidence_score'

save_root = '/home/zhuoming/ovd_imagenet'
# load the selected clip proposal
for i, image_id in enumerate(from_img_id_to_gtbbox):
    gt_cate_distri = {}
    gt_bboxes = from_img_id_to_gtbbox[image_id]
    # aggreate all the gt bbox categories base on the categories
    for bbox in gt_bboxes:
        category_id = bbox[-1]
        category_name = from_gt_cate_id_to_gt_cate_name[category_id]
        if category_name not in gt_cate_distri:
            gt_cate_distri[category_name] = 0
        gt_cate_distri[category_name] +=1
    # load the predict categories
    json_file_name = str(image_id).zfill(12) + '.json'
    full_file_path = os.path.join(target_res_file_root, json_file_name)
    clip_proposal_content = json.load(open(full_file_path))
    # aggregate the proposal base on the categories
    pred_distri = {}
    all_predicted_cate_id = clip_proposal_content['predicted_cates_for_all_imgs']
    for pred_cate_id in all_predicted_cate_id:
        pred_cate_name = from_pred_cate_id_to_pred_name[pred_cate_id]
        if pred_cate_name not in pred_distri:
            pred_distri[pred_cate_name] = 0
        pred_distri[pred_cate_name] += 1
    gt_cate_distri = dict(sorted(gt_cate_distri.items(), key=lambda item: item[1], reverse=True))
    pred_distri = dict(sorted(pred_distri.items(), key=lambda item: item[1], reverse=True)) 
    print('image_id', image_id, 'gt_cate_distri', gt_cate_distri, 'pred_distri', pred_distri)
    
    # aggregate bbox for the categories id
    from_cate_to_bbox = {}
    for bbox, cate_id in zip(clip_proposal_content['score'], clip_proposal_content['predicted_cates_for_all_imgs']):
        if cate_id not in from_cate_to_bbox:
            from_cate_to_bbox[cate_id] = []
        from_cate_to_bbox[cate_id].append(bbox)
    # obtain the top 3 categories id    
    target_cate_id = [from_pred_name_to_pred_cate_id[cate_id] for i, cate_id in enumerate(pred_distri.keys()) if i < 3]
    
    # download the image 
    url = all_img_info[image_id]['coco_url']
    file_name = all_img_info[image_id]['file_name']
    save_path = save_root + file_name
    r = requests.get(url)

    if not os.path.exists(save_root):
        os.makedirs(save_root)
    with open(save_path, 'wb') as f:
        f.write(r.content)      
    # print the image

    im = np.array(Image.open(save_path), dtype=np.uint8)
    fig,ax = plt.subplots(1)

    # Display the image
    ax.imshow(im)
    
    colors = ['red', 'blue', 'green']

    # if img_id in from_img_id_to_gt:
    #    for box in from_img_id_to_gt[img_id]:
    #        #box = annotation['bbox']
    #        rect = patches.Rectangle((box[0], box[1]),box[2],box[3],linewidth=1,edgecolor='g',facecolor='none')
    #        ax.add_patch(rect)
    for cate, color in zip(target_cate_id, colors):
        all_clip_proposal_per_cate = from_cate_to_bbox[cate]

        for j, box in enumerate(all_clip_proposal_per_cate):
            #box = annotation['bbox']
            rect = patches.Rectangle((box[0], box[1]),box[2]-box[0],box[3]-box[1],linewidth=1,edgecolor=color,facecolor='none')
            ax.add_patch(rect)
            if j > 10:
                break

    #Add the patch to the Axes
    #plt.show()
    print_path = os.path.join(save_root, 'printed')
    if not os.path.exists(print_path):
        os.makedirs(print_path)

    plt.savefig(print_path+file_name)
    plt.close()    
    if i > 5:
        break